<!doctype HTML>
<html>
  <head>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css">

    <script src="https://cdn.jsdelivr.net/npm/ol@v8.2.0/dist/ol.js"></script>
    <script src="js/aframe.min.js"></script>
    <script src="js/aframe-ar.js"></script>
    <script type="module" src="js/eox-map.js"></script>
    <script src="https://unpkg.com/aframe-openlayers-component/dist/aframe-openlayers-component.min.js"></script>
    <title>EOX Augmented Reality Demo</title>
  </head>
  <body style="margin: 0px; overflow: hidden;">
    <script>
      AFRAME.registerComponent('updater', {
        init: function() {
          // declare variable for later access
          this.num = 0;
          // you can also access the underlying 3D object of a scene object,
          //   for example:
          // let target = document.querySelector('#earth').object3D;
          // target.scale.set( 0.75, 0.75, 0.75 );
        },

        // time      = total time since init (milliseconds)
        // timeDelta = time since last tick
        tick: function(time, timeDelta) {
          this.num += 1;
          // console.log( this.num );
        }
      });

      // access underlying 3D object this component is attached to
      AFRAME.registerComponent('spinner', {
        init: function() {
            this.el.object3D.scale.set(0.75, 0.75, 0.75);
        },

        tick: function(time, timeDelta) {
            this.el.object3D.rotation.y += 0.01;
        },
      });

      var source1 = new ol.source.OSM();
        var layer1 = new ol.layer.Tile({
          source: source1
        });
        var source2 = new ol.source.Vector({
            url: 'https://openlayers.org/en/v4.6.5/examples/data/geojson/countries.geojson',
            format: new ol.format.GeoJSON()
        });
        var layer2 = new ol.layer.Vector({
            source: source2
        });
        var map = new ol.Map({
            layers: [
                layer1,
                layer2
            ],
            target: 'map',
            controls: ol.control.defaults.defaults({
                attributionOptions: {
                    collapsible: false
                }
            }),
            view: new ol.View({
                center: [0, 0],
                zoom: 0.7
            })
        });
      /*
      AFRAME.registerComponent('draw-canvas', {
        schema: {default: ''},

        init: function () {
          this.canvas = document.getElementById(this.data);
          this.ctx = this.canvas.getContext('2d');

          // Draw on canvas...
        }
      });
      */
    </script>
    <a-scene embedded vr-mode-ui="enabled: false;" arjs="debugUIEnabled: false;">
      <a-assets>
        <img id="earth-sphere" src="./images/navball.png" />
        <!--<canvas id="map-canvas" crossorigin="anonymous"></canvas>-->
        <div id="map"></div>
      </a-assets>
      <a-marker type="pattern" url="./patterns/hiro.patt">
        <a-sphere 
          id="earth"
          position="0 0.5 0"
          material="transparent: true; opacity: 1.0;"
          ol="map: map;
            aframeEvent: click;
            OlEvent: click;
              pixToVRRatio:200;"
          spinner >
        </a-sphere>
      </a-marker>
      <a-entity camera></a-entity>
      <!-- empty entity, running previously declared script -->
      <a-entity updater></a-entity>
    </a-scene>
  </body>
</html>
